# 要件定義？

とりあえずやりたいことを列挙する

## 作りたいもの

-   ルーム制のチャット

## やりたいこと

### 存在するもの

-   エントランスとルームがある
    -   エントランスは入室用のページ
    -   ルームはチャットするためのページ

### 存在しないもの

-   ルームリスト
    -   今のところは検討しない

#### エントランス

-   ルーム名とユーザー名を入力して入室できる
    -   入室時にログイン処理を行う
    -   ルームに直入室された場合、localStrage の情報を使ってログイン処理をする
    -   ログイン時にユーザー情報を localStrage に保存
        -   このとき、サーバーから UUID を発行してもらう
    -   情報に問題があればエラー表示

#### ルーム

-   ルームではチャット発言ができる
    -   ログインユーザーのみが発言できる
        -   ログインしていないユーザーは発言できない（ステルス発言の防止）
        -   KeepAlive 通信でユーザーの生死判定をする
            -   死んだユーザーは弾き出す
                -   1 分応答がなければ弾く
    -   自分の発言と他社の発言は区別されて表示される
-   ルームは無人になってもデータが残る
-   入室者一覧が見れる

## 使用技術

### フロントエンド

-   React, TypeScript
    -   チャット送信は REST で行うことで到着管理をする

### バックエンド

-   Nodejs + MySQL
    - クライアントからの要求はREST、サーバーからのメッセージはWS
    -   メッセージの到着管理をする
        -   メッセージには ID を付与する
        -   クライアント側で受信 ID が異なれば再送要求をする
    -   ルームごとに入室者管理とメッセージ管理が必要

#### メッセージ管理案

何を ID にするかは決めてない。恐らくはタイムスタンプか何か

-   OK パターン

```
SV->CL: ID:001, PrevID: null, MES:aaaa
SV->CL: ID:002, PrevID: 002, MES:bbbb
```

-   NG パターン
    -   ID:002 が欠損している
    -   ID:001 between ID:003 でサーバーに再送要求する
        -   再送要求は REST でやる
        -   クライアント側でメッセージをタイムスタンプソートして表示するのが無難そう
        -   タイムスタンプが同じ場合、UUID でソートする

```
SV->CL: ID:001, PrevID: null, MES:aaaa
SV->CL: ID:003, PrevID: 002, MES:bbbb
```
